(function(e){"use strict"
var t=this,n=t.SpeechRecognition||t.webkitSpeechRecognition||t.mozSpeechRecognition||t.msSpeechRecognition||t.oSpeechRecognition
if(!n)return t.speech=null,e
var o,r,c=[],a={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]},i=0,s=!1,l="font-weight: bold; color: #00f;",u=!1,h=/\s*\((.*?)\)\s*/g,f=/(\(\?:[^)]+\))\?/g,g=/(\(\?)?:\w+/g,p=/\*\w+/g,d=/[\-{}\[\]+?.,\\\^$|#]/g,m=function(e){return e=e.replace(d,"\\$&").replace(h,"(?:$1)?").replace(g,function(e,t){return t?e:"([^\\s]+)"}).replace(p,"(.*?)").replace(f,"\\s*$1?\\s*"),new RegExp("^"+e+"$","i")},w=function(e){e.forEach(function(e){e.callback.apply(e.context)})},v=function(){b()||t.speech.init({},!1)},b=function(){return o!==e}
t.speech={init:function(h,f){f=f===e?!0:!!f,o&&o.abort&&o.abort(),o=new n,o.maxAlternatives=5,o.continuous="http:"===t.location.protocol,o.lang="en-US",o.onstart=function(){w(a.start)},o.onerror=function(e){switch(w(a.error),e.error){case"network":w(a.errorNetwork)
break
case"not-allowed":case"service-not-allowed":r=!1,w((new Date).getTime()-i<200?a.errorPermissionBlocked:a.errorPermissionDenied)}},o.onend=function(){if(w(a.end),r){var e=(new Date).getTime()-i
1e3>e?setTimeout(t.speech.start,1e3-e):t.speech.start()}},o.onresult=function(e){if(u)return s&&t.console.log("Speech heard, but speech is paused"),!1
w(a.result)
for(var n,o=e.results[e.resultIndex],r=0;r<o.length;r++){n=o[r].transcript.trim(),s&&t.console.log("Speech recognized: %c"+n,l)
for(var i=0,h=c.length;h>i;i++){var f=c[i].command.exec(n)
if(f){var g=f.slice(1)
return s&&(t.console.log("command matched: %c"+c[i].originalPhrase,l),g.length&&t.console.log("with parameters",g)),c[i].callback.apply(this,g),w(a.resultMatch),!0}}}return w(a.resultNoMatch),!1},f&&(c=[]),h.length&&this.addCommands(h)},start:function(n){u=!1,v(),n=n||{},r=n.autoRestart!==e?!!n.autoRestart:!0,n.continuous!==e&&(o.continuous=!!n.continuous),i=(new Date).getTime()
try{o.start()}catch(c){s&&t.console.log(c.message)}},abort:function(){r=!1,b&&o.abort()},pause:function(){u=!0},resume:function(){t.speech.start()},debug:function(e){s=arguments.length>0?!!e:!0},setLanguage:function(e){v(),o.lang=e},addCommands:function(e){var n,o
v()
for(var r in e)if(e.hasOwnProperty(r)){if(n=t[e[r]]||e[r],"function"!=typeof n)continue
o=m(r),c.push({command:o,callback:n,originalPhrase:r})}s&&t.console.log("Commands successfully loaded: %c"+c.length,l)},removeCommands:function(t){return t===e?void(c=[]):(t=Array.isArray(t)?t:[t],void(c=c.filter(function(e){for(var n=0;n<t.length;n++)if(t[n]===e.originalPhrase)return!1
return!0})))},addCallback:function(n,o,r){if(a[n]!==e){var c=t[o]||o
"function"==typeof c&&a[n].push({callback:c,context:r||this})}}}}).call(this)
